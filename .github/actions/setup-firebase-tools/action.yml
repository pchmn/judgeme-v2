name: Setup Firebase CLI

inputs:
  packager:
    description: The package manager used to install the CLI
    default: pnpm
  version:
    description: Version of Firebase CLI
    default: latest
  serviceAccountKey:
    description: Service account key to use
  projectId:
    description: Project id to use

runs:
  using: composite
  steps:
    - if: ${{ inputs.packager == 'pnpm' }}
      name: Install firebase-tools with pnpm
      shell: bash
      run: pnpm add -g firebase-tools@${{ inputs.version }}

    - if: ${{ inputs.packager == 'yarn' }}
      name: Install firebase-tools with pnpm
      shell: bash
      run: yarn global add firebase-tools@${{ inputs.version }}

    - if: ${{ inputs.packager == 'npm' }}
      name: Install firebase-tools with pnpm
      shell: bash
      run: npm install -g firebase-tools@${{ inputs.version }}

    - if: ${{ inputs.projectId != '' }}
      name: Use firebase project
      shell: bash
      run: firebase use ${{ inputs.projectId }}

    - if: ${{ inputs.serviceAccountKey != '' }}
      name: Add service account key
      shell: bash
      run: |
        echo ${{ inputs.serviceAccountKey }} > $HOME/serviceAccountKey.json
        export GOOGLE_APPLICATION_CREDENTIALS=$HOME/serviceAccountKey.json
